---
title: "STAT646 Final Exam"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Multiple choices
1-c, 2-b, 3-a, 4-e, 5-e, 6-e

# Problem 7
###Part i.

12882 Child,
12877 Father,
12878 Mother,
12891 Maternal grandfather,
12892 Maternal grandmother


###Part ii.a
```{r message=FALSE}
PP <- read.table("PPallAA.txt", header = T)
```


Total number inherited from the father (_F)
```{r message=FALSE}
ref_a <- sum(PP$NA12882_PP_F>0.9 & PP$NA12877_PP_F>0.9)
var_a <- sum(PP$NA12882_PP_F<0.1 & PP$NA12877_PP_F<0.1)
ref_a+var_a  
```

###Part ii.b
Total number inherited from the mother (_F)
```{r message=FALSE}
ref_b <- sum(PP$NA12882_PP_F>0.9 & PP$NA12878_PP_F>0.9)
var_b <- sum(PP$NA12882_PP_F<0.1 & PP$NA12878_PP_F<0.1)
ref_b+var_b 
```

###Part ii.c
Total number inherited from the mother, who inherited from the maternal grandmother (_F)
```{r}
ref_c <- sum(PP$NA12882_PP_F>0.9 & PP$NA12878_PP_F>0.9 & PP$NA12892_PP_F>0.9)
var_c <- sum(PP$NA12882_PP_F<0.1 & PP$NA12878_PP_F<0.1 & PP$NA12892_PP_F<0.1)
ref_c+var_c 
```

###Part iii.a
Total number inherited from the father (_S)
```{r}
ref_a_s <- sum(PP$NA12882_PP_S>0.9 & PP$NA12877_PP_S>0.9)
var_a_s <- sum(PP$NA12882_PP_S<0.1 & PP$NA12877_PP_S<0.1)
ref_a_s+var_a_s 
```

###Part iii.b
Total number inherited from the mother (_S)
```{r}
ref_b_s <- sum(PP$NA12882_PP_S>0.9 & PP$NA12878_PP_S>0.9)
var_b_s <- sum(PP$NA12882_PP_S<0.1 & PP$NA12878_PP_S<0.1)
ref_b_s+var_b_s 
```


###Part iii.c
Total number inherited from the mother, who inherited from the maternal grandmother (_S)
```{r}
ref_c_s <- sum(PP$NA12882_PP_S>0.9 & PP$NA12878_PP_S>0.9 & PP$NA12892_PP_S>0.9)
var_c_s <- sum(PP$NA12882_PP_S<0.1 & PP$NA12878_PP_S<0.1 & PP$NA12892_PP_S<0.1)
ref_c_s+var_c_s 
```


Checking for overlaps for the Venn Diagram
```{r}
a<-sum(PP$NA12882_PP_S>0.9 & PP$NA12877_PP_S>0.9&PP$NA12882_PP_F>0.9 &
      PP$NA12877_PP_F>0.9)
b<-sum(PP$NA12882_PP_S<0.1 & PP$NA12877_PP_S<0.1&PP$NA12882_PP_F<0.1 &
      PP$NA12877_PP_F<0.1)

c<-sum(PP$NA12882_PP_S>0.9 & PP$NA12878_PP_S>0.9&PP$NA12882_PP_F>0.9 &
      PP$NA12878_PP_F>0.9)
d<-sum(PP$NA12882_PP_S<0.1 & PP$NA12878_PP_S<0.1&PP$NA12882_PP_F<0.1 &
      PP$NA12878_PP_F<0.1)

e<-sum(PP$NA12882_PP_F>0.9 & PP$NA12878_PP_F>0.9 & PP$NA12892_PP_F>0.9&
      PP$NA12882_PP_S>0.9 & PP$NA12878_PP_S>0.9 & PP$NA12892_PP_S>0.9)
f<-sum(PP$NA12882_PP_F<0.1 & PP$NA12878_PP_F<0.1 & PP$NA12892_PP_F<0.1&
      PP$NA12882_PP_S<0.1 & PP$NA12878_PP_S<0.1 & PP$NA12892_PP_S<0.1)
```


Plot Venn diagrams
```{r message=FALSE}
library(VennDiagram)
grid.newpage()
draw.pairwise.venn(area1 = 10898, area2 = 10898, cross.area = 10898, category = c("iia", "iiia"))

grid.newpage()
draw.pairwise.venn(area1 = 11277, area2 = 11275, cross.area = 11275, category = c("iib", "iiib"))

grid.newpage()
draw.pairwise.venn(area1 = 8103, area2 = 8098, cross.area = 8097, category = c("iic", "iiic"))

```

# Problem 8
###Part i
The package provides a RangedSummarizedExperiment object
of read counts in genes for an RNA-Seq experiment on four human
airway smooth muscle cell lines treated with dexamethasone. In the experiment, four primary human airway smooth muscle cell lines were treated with 1 micromolar dexamethasone for 18 hours. For each of the four cell lines, we have a treated and an untreated sample.

###Part ii
```{r message=FALSE}
library(DESeq2)
library(airway)
data("airway")
se <- airway
se$dex <- relevel(se$dex, "untrt")
```

Both cell type and treatment status
```{r message=FALSE}
dds <- DESeqDataSet(se, design = ~ cell + dex)
dds <- dds[ rowSums(counts(dds)) > 1, ]
dds <- DESeq(dds)
res <- results(dds)

topGene <- rownames(res)[which.min(res$padj)]
res <- res[-which.min(res$padj),]
topGene2 <- rownames(res)[which.min(res$padj)]
res <- res[-which.min(res$padj),]
topGene3 <- rownames(res)[which.min(res$padj)]
```

The top three genes with the lowest p-adj values
```{r}
topGene
topGene2
topGene3
```

###Part iii
Treatment status only
```{r message=FALSE}
dds_2 <- DESeqDataSet(se, design = ~ dex)
dds_2 <- dds_2[ rowSums(counts(dds_2)) > 1, ]
dds_2 <- DESeq(dds_2)
res_2 <- results(dds_2)

topGene_2 <- rownames(res_2)[which.min(res_2$padj)]
res_2 <- res_2[-which.min(res_2$padj),]
topGene2_2 <- rownames(res_2)[which.min(res_2$padj)]
res_2 <- res_2[-which.min(res_2$padj),]
topGene3_2 <- rownames(res_2)[which.min(res_2$padj)]
```

The top three genes with the lowest p-adj values
```{r}
topGene_2 
topGene2_2
topGene3_2
```

###Part iv

Define a function used to plot a 6-panel figure
```{r}
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  library(grid)
  plots <- c(list(...), plotlist)
  numPlots = length(plots)
  if (is.null(layout)) {
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    for (i in 1:numPlots) {
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

Graphs for both type and treatment status
```{r message=FALSE}
library("ggbeeswarm")
library("ggplot2")
geneCounts <- plotCounts(dds, gene = topGene, intgroup = c("dex","cell"),
                         returnData = TRUE)
p1_1 = ggplot(geneCounts, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
geneCounts <- plotCounts(dds, gene = topGene2, intgroup = c("dex","cell"),
                         returnData = TRUE)
p1_2 = ggplot(geneCounts, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
geneCounts <- plotCounts(dds, gene = topGene3, intgroup = c("dex","cell"),
                         returnData = TRUE)
p1_3 = ggplot(geneCounts, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
```

Graphs for treatment status only
```{r}
geneCounts_2 <- plotCounts(dds_2, gene = topGene_2, intgroup = c("dex","cell"),
                         returnData = TRUE)
p2_1 = ggplot(geneCounts_2, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
geneCounts_2 <- plotCounts(dds, gene = topGene2_2, intgroup = c("dex","cell"),
                         returnData = TRUE)
p2_2 = ggplot(geneCounts_2, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
geneCounts_2 <- plotCounts(dds, gene = topGene3_2, intgroup = c("dex","cell"),
                         returnData = TRUE)
p2_3 = ggplot(geneCounts_2, aes(x = dex, y = count, color = cell)) +
  scale_y_log10() +  geom_beeswarm(cex = 3)
```

Plot a 6-panel figure using the multiplot function defined earlier. The top three graphs are for part ii. The bottom three graphs are for part iii.
```{r}
multiplot(p1_1, p2_1, p1_2, p2_2, p1_3, p2_3 ,cols = 3)
```


```{r}
sessionInfo()
```

